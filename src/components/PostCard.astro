---
import { getPostPermalink } from '../lib/posts';
import type { PostEntry } from '../lib/posts';
import { withBase } from '../lib/urls';

const { post } = Astro.props as { post: PostEntry };
const permalink = getPostPermalink(post);
const coverImage = post.data.cover_image;
const coverImageUrl = coverImage?.startsWith('http') ? coverImage : coverImage ? withBase(coverImage) : undefined;
const dateLabel = post.data.date.toLocaleDateString('he-IL', {
	year: 'numeric',
	month: 'long',
	day: 'numeric',
});
---

<article class="post-card">
	{
		coverImageUrl && (
			<a class="post-cover-link" href={permalink} aria-label={post.data.title}>
				<img class="post-cover-image" src={coverImageUrl} alt={post.data.title} loading="lazy" decoding="async" />
			</a>
		)
	}
	<div class="post-meta">
		<span>{dateLabel}</span>
		{post.data.episode && <span>פרק {post.data.episode}</span>}
	</div>
	<h3 dir="auto"><a href={permalink} dir="auto">{post.data.title}</a></h3>
	{post.data.summary && <p>{post.data.summary}</p>}
	{post.data.tags && post.data.tags.length > 0 && (
		<div class="post-tags">
			{post.data.tags.slice(0, 4).map((tag) => (
				<span class="post-tag">{tag}</span>
			))}
		</div>
	)}
</article>
